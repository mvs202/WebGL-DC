<!DOCTYPE html>
html>
<head>
<title>Lincoln Memorial CaBi Trips</title>
<style>
body {
  background-color: #000000;
  font-family: Monospace;
  cursor: url(cursor.png), auto;
  margin: 0;
  overflow: hidden;
  }
#instructions {
  position: absolute;
  top: 15px;
  width: 100%;
  color: #BBBBFF;
  text-align: center;
  }
</style>
</head>
<body>
<script src="../../lib/three.min.js"></script>
<script src="../../lib/Projector.js"></script>
<script src="../../lib/MapControls.js"></script>
<script>
// Mesh = Geometry + Material
var scene, camera, renderer;
var globalScale = 0.022;  // how to convert meters to pixels
var light;
var ground;
var lastTime;
var minLng, maxLng, minLat, maxLat;
var worldWidth = 400;
var worldHeight = 400;
var lookingAt = {point: new THREE.Vector3(0, 0, 0), theta: 0};
var cursor = {x: window.innerWidth/2, y: window.innerHeight/2};
var LincolnTraffic = [{trips:1,lat:38.85632,lng:-77.11153},{trips:1,lat:38.92874,lng:-77.01246},{trips:1,lat:38.96115,lng:-77.08866},{trips:1,lat:38.820065,lng:-77.05762},{trips:1,lat:38.834106,lng:-77.087326},{trips:1,lat:38.848454,lng:-77.084915},{trips:1,lat:38.897064,lng:-76.94745},{trips:1,lat:38.898537,lng:-76.93186},{trips:1,lat:38.927498,lng:-76.99719},{trips:1,lat:38.928642,lng:-76.99095},{trips:1,lat:38.977932,lng:-77.00647},{trips:2,lat:38.975,lng:-77.01121},{trips:2,lat:38.9418,lng:-77.0251},{trips:2,lat:38.84736,lng:-77.09543},{trips:2,lat:38.85469,lng:-77.100555},{trips:2,lat:38.86661,lng:-76.98524},{trips:2,lat:38.857803,lng:-77.08673},{trips:2,lat:38.894474,lng:-76.97483},{trips:2,lat:38.896545,lng:-76.96012},{trips:2,lat:38.997654,lng:-77.0345},{trips:3,lat:38.85225,lng:-77.10502},{trips:3,lat:38.98954,lng:-77.09803},{trips:3,lat:38.837666,lng:-77.09482},{trips:3,lat:38.932514,lng:-76.99289},{trips:4,lat:38.92068,lng:-76.99587},{trips:4,lat:38.95481,lng:-77.08243},{trips:4,lat:38.811455,lng:-77.05028},{trips:4,lat:38.956432,lng:-77.03294},{trips:4,lat:38.992374,lng:-77.100105},{trips:5,lat:38.9346,lng:-76.9955},{trips:5,lat:38.867374,lng:-76.98804},{trips:5,lat:38.869442,lng:-77.1045},{trips:5,lat:38.933666,lng:-76.99101},{trips:5,lat:38.977093,lng:-77.09459},{trips:6,lat:38.80111,lng:-77.068954},{trips:6,lat:38.896133,lng:-76.9929},{trips:6,lat:38.943836,lng:-77.07708},{trips:6,lat:38.955017,lng:-77.069954},{trips:6,lat:38.983837,lng:-77.09221},{trips:7,lat:38.96176,lng:-77.086},{trips:7,lat:38.805317,lng:-77.04988},{trips:7,lat:38.876736,lng:-76.99447},{trips:7,lat:38.920387,lng:-77.02567},{trips:7,lat:38.947773,lng:-77.03282},{trips:8,lat:38.9249,lng:-77.0222},{trips:8,lat:38.86079,lng:-77.09586},{trips:8,lat:38.91908,lng:-77.00065},{trips:8,lat:38.839912,lng:-77.08708},{trips:9,lat:38.86612,lng:-77.08787},{trips:9,lat:38.89538,lng:-77.09713},{trips:9,lat:38.833076,lng:-77.05982},{trips:9,lat:38.871822,lng:-77.1079},{trips:9,lat:38.928158,lng:-77.02344},{trips:9,lat:38.964993,lng:-77.10338},{trips:10,lat:38.9375,lng:-77.0328},{trips:10,lat:38.80438,lng:-77.06087},{trips:10,lat:38.82093,lng:-77.05309},{trips:10,lat:38.82595,lng:-77.05854},{trips:10,lat:38.873756,lng:-77.08923},{trips:10,lat:38.918156,lng:-77.004745},{trips:10,lat:38.936043,lng:-77.02465},{trips:10,lat:38.982456,lng:-77.09199},{trips:11,lat:38.80565,lng:-77.05293},{trips:11,lat:38.98469,lng:-77.094536},{trips:11,lat:38.802677,lng:-77.06356},{trips:11,lat:38.883923,lng:-77.11681},{trips:12,lat:38.876392,lng:-77.107735},{trips:12,lat:38.895927,lng:-77.10525},{trips:14,lat:38.900414,lng:-76.98287},{trips:14,lat:38.983524,lng:-77.09537},{trips:15,lat:38.981102,lng:-77.09743},{trips:16,lat:38.87887,lng:-77.1207},{trips:16,lat:38.89494,lng:-77.09169},{trips:17,lat:38.814575,lng:-77.05281},{trips:17,lat:38.847977,lng:-77.0751},{trips:17,lat:38.897194,lng:-76.983574},{trips:18,lat:38.884617,lng:-77.10108},{trips:18,lat:38.903732,lng:-76.98721},{trips:19,lat:38.82175,lng:-77.04749},{trips:19,lat:38.910973,lng:-77.00495},{trips:20,lat:38.8858,lng:-77.09775},{trips:21,lat:38.8444,lng:-77.08593},{trips:21,lat:38.88367,lng:-77.11391},{trips:21,lat:38.880833,lng:-77.091125},{trips:22,lat:38.8896,lng:-76.9769},{trips:22,lat:38.898983,lng:-77.078316},{trips:23,lat:38.8647,lng:-77.048676},{trips:24,lat:38.884,lng:-76.9861},{trips:24,lat:38.90801,lng:-76.99699},{trips:25,lat:38.947605,lng:-77.079384},{trips:26,lat:38.89593,lng:-77.089005},{trips:27,lat:38.846222,lng:-77.069275},{trips:27,lat:38.938736,lng:-77.08717},{trips:28,lat:38.91762,lng:-77.01597},{trips:29,lat:38.805767,lng:-77.06072},{trips:30,lat:38.8815,lng:-77.10396},{trips:32,lat:38.93488,lng:-77.072754},{trips:34,lat:38.85069,lng:-77.05152},{trips:34,lat:38.89324,lng:-77.086044},{trips:34,lat:38.90509,lng:-76.9941},{trips:34,lat:38.91266,lng:-77.01767},{trips:34,lat:38.942017,lng:-77.03265},{trips:35,lat:38.88786,lng:-77.09487},{trips:36,lat:38.889,lng:-77.0925},{trips:37,lat:38.929462,lng:-77.027824},{trips:39,lat:38.8792,lng:-76.9953},{trips:39,lat:38.88279,lng:-77.10315},{trips:40,lat:38.94455,lng:-77.063896},{trips:41,lat:38.894833,lng:-76.98763},{trips:43,lat:38.884735,lng:-77.09348},{trips:44,lat:38.9003,lng:-76.9882},{trips:44,lat:38.9308,lng:-77.0315},{trips:44,lat:38.9319,lng:-77.0388},{trips:45,lat:38.915417,lng:-77.01229},{trips:47,lat:38.90706,lng:-77.01523},{trips:48,lat:38.90864,lng:-77.02277},{trips:48,lat:38.899982,lng:-76.99139},{trips:49,lat:38.9155,lng:-77.0222},{trips:49,lat:38.87322,lng:-77.08211},{trips:50,lat:38.8803,lng:-76.9862},{trips:50,lat:38.9172,lng:-77.0259},{trips:52,lat:38.91376,lng:-77.02702},{trips:52,lat:38.896923,lng:-77.0865},{trips:53,lat:38.92258,lng:-77.070335},{trips:54,lat:38.81074,lng:-77.04466},{trips:55,lat:38.8904,lng:-77.0889},{trips:55,lat:38.881042,lng:-77.11177},{trips:56,lat:38.862476,lng:-77.0866},{trips:57,lat:38.8561,lng:-77.0512},{trips:57,lat:38.92265,lng:-77.07727},{trips:57,lat:38.92333,lng:-77.0352},{trips:58,lat:38.91272,lng:-77.022156},{trips:58,lat:38.896015,lng:-77.07811},{trips:60,lat:38.844013,lng:-77.05054},{trips:60,lat:38.881184,lng:-77.00183},{trips:62,lat:38.84232,lng:-77.089554},{trips:62,lat:38.934265,lng:-77.057976},{trips:64,lat:38.88397,lng:-77.10783},{trips:64,lat:38.89967,lng:-77.00367},{trips:66,lat:38.92067,lng:-77.04368},{trips:67,lat:38.86247,lng:-77.068245},{trips:67,lat:38.804718,lng:-77.043365},{trips:68,lat:38.88496,lng:-77.08777},{trips:69,lat:38.8743,lng:-77.0057},{trips:70,lat:38.8881,lng:-77.09308},{trips:71,lat:38.8426,lng:-77.0502},{trips:74,lat:38.9126,lng:-77.0135},{trips:74,lat:38.880707,lng:-77.08596},{trips:77,lat:38.87501,lng:-77.0024},{trips:78,lat:38.889908,lng:-76.98333},{trips:79,lat:38.9268,lng:-77.0322},{trips:81,lat:38.86942,lng:-77.0956},{trips:82,lat:38.89997,lng:-76.998344},{trips:82,lat:38.857864,lng:-77.05949},{trips:83,lat:38.921074,lng:-77.03188},{trips:84,lat:38.85353,lng:-77.05351},{trips:90,lat:38.897614,lng:-77.08085},{trips:91,lat:38.8763,lng:-77.0037},{trips:92,lat:38.88732,lng:-76.98357},{trips:94,lat:38.90571,lng:-77.003044},{trips:99,lat:38.897274,lng:-76.99475},{trips:102,lat:38.88263,lng:-77.10937},{trips:103,lat:38.916443,lng:-77.0682},{trips:108,lat:38.89046,lng:-76.98836},{trips:110,lat:38.941154,lng:-77.062035},{trips:112,lat:38.848442,lng:-77.05151},{trips:112,lat:38.916786,lng:-77.02814},{trips:112,lat:38.917763,lng:-77.04062},{trips:114,lat:38.803123,lng:-77.04036},{trips:118,lat:38.86647,lng:-77.07613},{trips:120,lat:38.8533,lng:-77.0498},{trips:125,lat:38.894756,lng:-76.997116},{trips:126,lat:38.922924,lng:-77.04258},{trips:130,lat:38.926086,lng:-77.03654},{trips:132,lat:38.923203,lng:-77.04764},{trips:134,lat:38.899704,lng:-77.00891},{trips:143,lat:38.912647,lng:-77.04183},{trips:145,lat:38.918808,lng:-77.04157},{trips:147,lat:38.88695,lng:-76.9968},{trips:152,lat:38.930283,lng:-77.055595},{trips:158,lat:38.85725,lng:-77.05332},{trips:160,lat:38.86646,lng:-77.04826},{trips:166,lat:38.90382,lng:-77.0284},{trips:166,lat:38.892162,lng:-77.07938},{trips:167,lat:38.895344,lng:-77.016106},{trips:171,lat:38.857063,lng:-77.05114},{trips:174,lat:38.899406,lng:-77.01529},{trips:175,lat:38.891697,lng:-77.0846},{trips:178,lat:38.902203,lng:-77.04337},{trips:183,lat:38.90572,lng:-77.02226},{trips:189,lat:38.8629,lng:-77.0528},{trips:189,lat:38.92787,lng:-77.04336},{trips:191,lat:38.90304,lng:-77.01903},{trips:195,lat:38.900414,lng:-77.001945},{trips:197,lat:38.859253,lng:-77.06328},{trips:198,lat:38.903408,lng:-77.04365},{trips:199,lat:38.893646,lng:-77.0767},{trips:209,lat:38.91268,lng:-77.03168},{trips:215,lat:38.890614,lng:-77.0848},{trips:218,lat:38.9176,lng:-77.0321},{trips:218,lat:38.863834,lng:-77.08032},{trips:219,lat:38.88015,lng:-77.10767},{trips:222,lat:38.908142,lng:-77.03836},{trips:225,lat:38.87861,lng:-77.006004},{trips:232,lat:38.91554,lng:-77.03818},{trips:236,lat:38.889366,lng:-77.07729},{trips:249,lat:38.900356,lng:-77.01211},{trips:250,lat:38.9154,lng:-77.0446},{trips:255,lat:38.894722,lng:-77.04513},{trips:264,lat:38.9121,lng:-77.0387},{trips:267,lat:38.89841,lng:-77.04318},{trips:271,lat:38.903584,lng:-77.04479},{trips:272,lat:38.905605,lng:-77.02714},{trips:287,lat:38.884,lng:-76.9954},{trips:288,lat:38.904743,lng:-77.0416},{trips:295,lat:38.889988,lng:-76.99519},{trips:300,lat:38.87675,lng:-77.02127},{trips:301,lat:38.9066,lng:-77.03879},{trips:307,lat:38.9057,lng:-77.0056},{trips:308,lat:38.8851,lng:-77.0023},{trips:313,lat:38.90093,lng:-77.01868},{trips:320,lat:38.89054,lng:-77.08095},{trips:333,lat:38.889954,lng:-77.00035},{trips:335,lat:38.90154,lng:-77.04656},{trips:343,lat:38.89722,lng:-77.01935},{trips:372,lat:38.900284,lng:-77.02982},{trips:373,lat:38.86017,lng:-77.04959},{trips:377,lat:38.878433,lng:-77.03023},{trips:385,lat:38.9003,lng:-77.0429},{trips:391,lat:38.923584,lng:-77.05005},{trips:407,lat:38.8952,lng:-77.0436},{trips:407,lat:38.856213,lng:-77.04983},{trips:411,lat:38.908905,lng:-77.04478},{trips:421,lat:38.898403,lng:-77.024284},{trips:422,lat:38.89492,lng:-77.046585},{trips:423,lat:38.8767,lng:-77.0178},{trips:426,lat:38.90849,lng:-77.06358},{trips:448,lat:38.867264,lng:-77.07231},{trips:449,lat:38.9066,lng:-77.05152},{trips:454,lat:38.9086,lng:-77.0323},{trips:463,lat:38.897293,lng:-77.05557},{trips:477,lat:38.90985,lng:-77.03444},{trips:498,lat:38.88412,lng:-77.01745},{trips:508,lat:38.90366,lng:-77.03484},{trips:525,lat:38.8963,lng:-77.045},{trips:529,lat:38.897858,lng:-77.02698},{trips:535,lat:38.9008,lng:-77.047},{trips:545,lat:38.902,lng:-77.03353},{trips:553,lat:38.9024,lng:-77.02622},{trips:555,lat:38.90774,lng:-77.071655},{trips:568,lat:38.90276,lng:-77.03863},{trips:604,lat:38.90534,lng:-77.046776},{trips:606,lat:38.862305,lng:-77.05994},{trips:609,lat:38.8637,lng:-77.0633},{trips:624,lat:38.901756,lng:-77.05109},{trips:628,lat:38.897446,lng:-77.00989},{trips:645,lat:38.88738,lng:-77.00195},{trips:672,lat:38.887314,lng:-77.025764},{trips:681,lat:38.903828,lng:-77.05348},{trips:688,lat:38.89963,lng:-77.031685},{trips:692,lat:38.89968,lng:-77.04154},{trips:695,lat:38.90206,lng:-77.03832},{trips:695,lat:38.896103,lng:-77.04988},{trips:711,lat:38.8946,lng:-77.0723},{trips:727,lat:38.8997,lng:-77.02309},{trips:841,lat:38.9059,lng:-77.0325},{trips:948,lat:38.895912,lng:-77.02606},{trips:955,lat:38.89696,lng:-77.00493},{trips:958,lat:38.894573,lng:-77.01994},{trips:983,lat:38.903584,lng:-77.06779},{trips:1022,lat:38.9101,lng:-77.0444},{trips:1038,lat:38.897316,lng:-77.07099},{trips:1087,lat:38.898365,lng:-77.02787},{trips:1104,lat:38.89485,lng:-77.02324},{trips:1117,lat:38.89735,lng:-77.02247},{trips:1158,lat:38.905125,lng:-77.056885},{trips:1211,lat:38.898067,lng:-77.03182},{trips:1258,lat:38.886265,lng:-77.02224},{trips:1293,lat:38.90088,lng:-77.04891},{trips:1295,lat:38.89246,lng:-77.04657},{trips:1395,lat:38.90375,lng:-77.06269},{trips:1810,lat:38.88731,lng:-77.01397},{trips:1971,lat:38.887238,lng:-77.02823},{trips:2134,lat:38.892277,lng:-77.013916},{trips:2231,lat:38.894512,lng:-77.03162},{trips:2333,lat:38.89303,lng:-77.02602},{trips:2482,lat:38.90222,lng:-77.05922},{trips:2948,lat:38.8923,lng:-77.0436},{trips:3288,lat:38.89841,lng:-77.03963},{trips:3482,lat:38.88992,lng:-77.071304},{trips:3619,lat:38.8873,lng:-77.018936},{trips:3735,lat:38.8991,lng:-77.0337},{trips:4900,lat:38.88412,lng:-77.04657},{trips:7802,lat:38.888767,lng:-77.02858},{trips:11818,lat:38.879818,lng:-77.037415},{trips:11988,lat:38.888252,lng:-77.04942},{trips:15283,lat:38.888554,lng:-77.03243}];

function WashingtonMonument(lat, lng) {
  var obeliskGeometry = new THREE.Geometry();
  var height = 169.29;  // height in meters
  var pyramidBase = 0.9*height;
  var pyramidHalfWidth = 0.03*height;
  var bottomHalfWidth = 0.05*height;
  // Define each vertex:
  // The bottom plane:
  obeliskGeometry.vertices.push(new THREE.Vector3( bottomHalfWidth,            0,  bottomHalfWidth));
  obeliskGeometry.vertices.push(new THREE.Vector3( bottomHalfWidth,            0, -bottomHalfWidth));
  obeliskGeometry.vertices.push(new THREE.Vector3(-bottomHalfWidth,            0, -bottomHalfWidth));
  obeliskGeometry.vertices.push(new THREE.Vector3(-bottomHalfWidth,            0,  bottomHalfWidth));
  // Base of the pyramid:
  obeliskGeometry.vertices.push(new THREE.Vector3( pyramidHalfWidth, pyramidBase,  pyramidHalfWidth));
  obeliskGeometry.vertices.push(new THREE.Vector3( pyramidHalfWidth, pyramidBase, -pyramidHalfWidth));
  obeliskGeometry.vertices.push(new THREE.Vector3(-pyramidHalfWidth, pyramidBase, -pyramidHalfWidth));
  obeliskGeometry.vertices.push(new THREE.Vector3(-pyramidHalfWidth, pyramidBase,  pyramidHalfWidth));
  // The tippy-top:
  obeliskGeometry.vertices.push(new THREE.Vector3(0, height, 0));
  // Create the faces:
  // Floor:
  obeliskGeometry.faces.push(new THREE.Face3(0, 2, 1), new THREE.Face3(0, 3, 2));
  // The four main sides (each side is two triangles):
  obeliskGeometry.faces.push(new THREE.Face3(0, 1, 5), new THREE.Face3(0, 5, 4));
  obeliskGeometry.faces.push(new THREE.Face3(1, 2, 6), new THREE.Face3(1, 6, 5));
  obeliskGeometry.faces.push(new THREE.Face3(2, 3, 7), new THREE.Face3(2, 7, 6));
  obeliskGeometry.faces.push(new THREE.Face3(3, 0, 4), new THREE.Face3(3, 4, 7));
  // Four sides of the pyramid:
  obeliskGeometry.faces.push(new THREE.Face3(4, 5, 8));
  obeliskGeometry.faces.push(new THREE.Face3(6, 7, 8));
  obeliskGeometry.faces.push(new THREE.Face3(5, 6, 8));
  obeliskGeometry.faces.push(new THREE.Face3(7, 4, 8));
  obeliskGeometry.computeFaceNormals();  // required to show directional light
  var obelisk = new THREE.Mesh(obeliskGeometry, new THREE.MeshLambertMaterial({vertexColors: THREE.VertexColors}));
  obelisk.scale.x = obelisk.scale.y = obelisk.scale.z = globalScale;
  obelisk.position.set(lngToX(lng), 0, latToZ(lat));
  obelisk.updateMatrix();
  return obelisk;
  }

function makeCylinder(radiusTop, radiusBottom, height, segments, floor) {
  var geometry = new THREE.CylinderGeometry(radiusTop, radiusBottom, height, segments);
  var cylinder = new THREE.Mesh(geometry);
  cylinder.position.y = height/2 + floor;
  cylinder.updateMatrix();
  return cylinder;
  }

function makeBox(depth, height, width, floor) {
  var box = new THREE.CubeGeometry(depth, height, width);
  var mesh = new THREE.Mesh(box);
  mesh.position.y = height/2 + floor;
  mesh.updateMatrix();
  return mesh;
  }

function DupontFountain(lat, lng) {
  var geometry = new THREE.Geometry();
  var cyl = makeCylinder(28.9, 28.9, 0.3, 48, 0.0);  geometry.merge(cyl.geometry, cyl.matrix);  // lowest base
  var cyl = makeCylinder(20.2, 20.2, 2.3, 36, 0.0);  geometry.merge(cyl.geometry, cyl.matrix);  // walkable circumference
  var cyl = makeCylinder(15.4, 15.4, 3.4, 24, 0.0);  geometry.merge(cyl.geometry, cyl.matrix);  // pool container
  var cyl = makeCylinder( 3.5,  3.5, 4.1, 24, 0.0);  geometry.merge(cyl.geometry, cyl.matrix);  // pedestal base
  var cyl = makeCylinder( 2.2,  3.5, 0.3, 24, 4.1);  geometry.merge(cyl.geometry, cyl.matrix);  // pedestal base's bevel
  var cyl = makeCylinder( 2.2,  2.2, 9.0, 24, 0.0);  geometry.merge(cyl.geometry, cyl.matrix);  // pedestal column
  var cyl = makeCylinder( 5.3,  2.3, 1.4, 24, 9.0);  geometry.merge(cyl.geometry, cyl.matrix);  // upper bowl
  var fountain = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({color: 0xffeeff}));
  fountain.scale.x = fountain.scale.y = fountain.scale.z = globalScale;
  fountain.position.x = lngToX(lng);
  fountain.position.z = latToZ(lat);
  fountain.updateMatrix();
  return fountain;
  }

function Pentagon(lat, lng) {
  var geometry = new THREE.Geometry();
  for (var i = 0; i < 5; i++) {  // each of five segments
    var theta = 2*Math.PI*i/5;
    geometry.vertices.push(new THREE.Vector3( 90*Math.sin(theta),  0,  90*Math.cos(theta)));
    geometry.vertices.push(new THREE.Vector3( 90*Math.sin(theta), 23,  90*Math.cos(theta)));
    geometry.vertices.push(new THREE.Vector3(240*Math.sin(theta), 23, 240*Math.cos(theta)));
    geometry.vertices.push(new THREE.Vector3(240*Math.sin(theta),  0, 240*Math.cos(theta)));
    }
  for (var i = 0; i < 5; i++) {
    var a = 4*i;
    var b = 4*((i + 1) % 5);
    geometry.faces.push(new THREE.Face3(    a, a + 1, b + 1), new THREE.Face3(    a, b + 1,     b));  // inner wall
    geometry.faces.push(new THREE.Face3(a + 1, a + 2, b + 2), new THREE.Face3(a + 1, b + 2, b + 1));  // roof
    geometry.faces.push(new THREE.Face3(a + 2, a + 3, b + 3), new THREE.Face3(a + 2, b + 3, b + 2));  // outer wall
    }
  geometry.computeFaceNormals();  // required to show directional light
  var pentagon = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({vertexColors: THREE.VertexColors}));
  pentagon.scale.x = pentagon.scale.y = pentagon.scale.z = globalScale;
  pentagon.position.set(lngToX(lng), 0, latToZ(lat));
  pentagon.updateMatrix();
  return pentagon;
  }

function JeffersonMemorial(lat, lng) {
  var geometry = new THREE.Geometry();
  var cyl = makeCylinder(25.5, 25.5, 0.9, 48,  0.0);  geometry.merge(cyl.geometry, cyl.matrix);  // lowest base
  var cyl = makeCylinder(24.0, 24.0, 1.8, 36,  0.0);  geometry.merge(cyl.geometry, cyl.matrix);  // 1st step up
  var cyl = makeCylinder(22.5, 22.5, 2.7, 24,  0.0);  geometry.merge(cyl.geometry, cyl.matrix);  // 2nd step up
  var cyl = makeCylinder(22.5, 22.5, 4.7, 24, 15.7);  geometry.merge(cyl.geometry, cyl.matrix);  // roof over columns
  var cyl = makeCylinder(18.0, 18.0, 3.3, 24, 20.4);  geometry.merge(cyl.geometry, cyl.matrix);  // lower base of the dome
  var cyl = makeCylinder(15.4, 15.4, 2.4, 24, 23.7);  geometry.merge(cyl.geometry, cyl.matrix);  // upper base of the dome
  var spheregeo = new THREE.SphereGeometry(14, 12, 9, 0, 2*Math.PI, 0, Math.PI/2);
  var dome = new THREE.Mesh(spheregeo);
  dome.position.y = 24;
  dome.scale.y = 0.67;
  dome.updateMatrix();
  geometry.merge(dome.geometry, dome.matrix);
  var cylgeo = new THREE.CylinderGeometry(0.9, 0.9, 13, 24);  // radiusTop, radiusBottom, height, segments
  var column = new THREE.Mesh(cylgeo);
  for (var i = 0; i < 36; i++) {  // 36 columns
    var distFromXAxis = sign(           i - 17.5)*Math.min(3.5, 9 - Math.abs(      i % 18 - 8.5));
    var distFromZAxis = sign((i + 9) % 36 - 17.5)*Math.min(5.5, 9 - Math.abs((i + 9) % 18 - 8.5));
    column.position.set(20.5*Math.sin(Math.PI*i/18), 9.2, 20.5*Math.cos(Math.PI*i/18));
    column.updateMatrix();
    geometry.merge(column.geometry, column.matrix);
    }
  var memorial = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({color: 0xffeeff}));
  memorial.scale.x = memorial.scale.y = memorial.scale.z = globalScale;
  memorial.position.set(lngToX(lng), 0, latToZ(lat));
  memorial.updateMatrix();
  return memorial;
  }

function LincolnMemorial(lat, lng) {
  var columnWidth = 61/23;  // about 2.65 meters
  var memorialWidth = columnWidth*23;  // 23 = 12 columns + 11 spaces
  var memorialDepth = columnWidth*15;  // 15 = 8 columns + 7 spaces
  var geometry = new THREE.Geometry();
  box = makeBox(memorialDepth - 11, 29, memorialWidth - 11,  0.0);  geometry.merge(box.geometry, box.matrix);  // interior container
  box = makeBox(memorialDepth,       4, memorialWidth,      19.0);  geometry.merge(box.geometry, box.matrix);  // roof over columns
  box = makeBox(memorialDepth,       3, memorialWidth,       0.0);  geometry.merge(box.geometry, box.matrix);  // walkable circumference
  box = makeBox(memorialDepth +  2,  2, memorialWidth +  2,  0.0);  geometry.merge(box.geometry, box.matrix);  // upper base
  box = makeBox(memorialDepth +  4,  1, memorialWidth +  4,  0.0);  geometry.merge(box.geometry, box.matrix);  // lower base
  var cylgeo = new THREE.CylinderGeometry(columnWidth/2 - 0.1, columnWidth/2 - 0.01, 16, 24);  // radiusTop, radiusBottom, height, segments
  var cylinder = new THREE.Mesh(cylgeo);
  for (var i = 0; i < 36; i++) {  // 36 columns
    var distFromXAxis = sign(           i - 17.5)*Math.min(3.5, 9 - Math.abs(      i % 18 - 8.5));
    var distFromZAxis = sign((i + 9) % 36 - 17.5)*Math.min(5.5, 9 - Math.abs((i + 9) % 18 - 8.5));
    cylinder.position.set(2*columnWidth*distFromXAxis, 11, 2*columnWidth*distFromZAxis);
    cylinder.updateMatrix();
    geometry.merge(cylinder.geometry, cylinder.matrix);
    }
  var memorial = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({color: 0xffeeff}));
  memorial.scale.x = memorial.scale.y = memorial.scale.z = globalScale;
  memorial.position.set(lngToX(lng), 0, latToZ(lat));
  memorial.updateMatrix();
  return memorial;
  }

function latToZ(lat) {
  return worldHeight*(lat - minLat)/(maxLat - minLat) - worldHeight/2;
  }

function lngToX(lng) {
  return worldWidth/2 - worldWidth*(lng - minLng)/(maxLng - minLng);
  }

function setBoundary(background, south, west, north, east, w, h) {
  minLng = west;  // left
  maxLng = east;  // right
  minLat = south;  // bottom
  maxLat = north;  // top
  swidth = w;
  sheight = h;
  }

function init() {
  setBoundary("region512.png", 38.78854, -77.27364, 39.12946, -76.83205, 640, 640);
  renderer = new THREE.WebGLRenderer({antialias: true, alpha: false});
  renderer.setClearColor(0x202040);
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);
  camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 1, 10000);
  camera.position.x = lngToX(-77.052115);
  camera.position.x = lngToX(-77.058);
  camera.position.z = latToZ(38.887);
  camera.position.y = 5;
  camera.up.set(0, 1, 0);
  controls = new MapControls(camera, render);
  lookingAt.point.x = lngToX(-77.035246);
  lookingAt.point.z = latToZ( 38.889376);
  camera.lookAt(lookingAt.point);
  camera.updateMatrix();
  scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x000000, 0.0015);  // color, density
  var directionalLight = new THREE.DirectionalLight(0xffffee, 0.5);
  directionalLight.position.set(-800, 1600, 400);
  scene.add(directionalLight);
  scene.add(new THREE.HemisphereLight(0xffffff , 0x000088, 1));  // skyColorHex, groundColorHex, intensity
  scene.add(new THREE.AmbientLight(0x334444));
  for (var i = 0; i < LincolnTraffic.length; i++) {
    var curve = new THREE.CatmullRomCurve3([
      new THREE.Vector3(lngToX(-77.049426), 0, latToZ(38.888251)),  // LincolnMemorial cabi station
      new THREE.Vector3(lngToX((LincolnTraffic[i].lng + -77.050153)/2), 10 + LincolnTraffic[i].trips/2000, latToZ((LincolnTraffic[i].lat + 38.889376)/2)),
      new THREE.Vector3(lngToX(LincolnTraffic[i].lng), 0, latToZ(LincolnTraffic[i].lat))
      ]);
    var geometry = new THREE.Geometry();
    geometry.vertices = curve.getPoints(50);
    var material = new THREE.LineBasicMaterial({color: 0xff0000});
    var splineObject = new THREE.Line(geometry, material);
    scene.add(splineObject);
    }
  var groundGeometry = new THREE.PlaneGeometry(worldWidth, worldHeight);
  var groundMaterial = new THREE.MeshBasicMaterial({side: THREE.DoubleSide});
  var textureLoader = new THREE.TextureLoader();
  textureLoader.load('region512.png', function(texture) {
    groundMaterial.map = texture;
    ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI/2;  // change from vertical to horizontal
    ground.rotation.z = Math.PI;  // have south end of image (the bottom) be closest to us
    scene.add(ground);
    });
  scene.add(WashingtonMonument(38.889376, -77.035246));
  scene.add(LincolnMemorial(38.889376, -77.050153));
  scene.add(JeffersonMemorial(38.881398, -77.036513));
  scene.add(DupontFountain(38.909662, -77.043415));
  scene.add(Pentagon(38.870998, -77.055964));
  lastTime = window.performance ? performance.now() : Date.now();
  }

function checkMouse(e) {
  cursor.x = e.clientX;
  cursor.y = e.clientY;
  }

function checkKeyboard(e) {
  var key = e.which || e.keyCode;
  // console.log(key)
  if (key == 108) {  // "L" for Lincoln Memorial:
    lookingAt.point.x = lngToX(-77.050153);
    lookingAt.point.z = latToZ( 38.889376);
    }
  if (key == 119) {  // "W" for Washington Monument:
    lookingAt.point.x = lngToX(-77.035246);
    lookingAt.point.z = latToZ( 38.889376);
    }
  camera.lookAt(lookingAt.point);
  }

function sign(x) {
  return x ? x < 0 ? -1 : 1 : 0;
  }

function animate() {
  requestAnimationFrame(animate);
  controls.update();
  var time = (window.performance ? performance.now() : Date.now())/1000;
  /*
  var horSpeed = Math.floor(8*(window.innerWidth/2 - cursor.x)/window.innerWidth);  // -4 to 4
  var verSpeed = Math.floor(8*(window.innerHeight/2 - cursor.y)/window.innerHeight);  // -4 to 4
  var lookingAt = camera.getWorldDirection();
  var theta = Math.atan2(lookingAt.x, lookingAt.z);
  //camera.position.x = camera.position.x + 0.03*(horSpeed*Math.cos(theta) + verSpeed*Math.sin(theta));
  //camera.position.z = camera.position.z + 0.03*(horSpeed*Math.sin(theta) + verSpeed*Math.cos(theta));
  camera.position.x = camera.position.x + 0.03*horSpeed*Math.cos(theta);
  camera.position.z = camera.position.z + 0.03*horSpeed*Math.sin(theta);
  //camera.position.x = camera.position.x + 0.03*(horSpeed*Math.cos(theta));
  //camera.position.z = camera.position.z + 0.03*(horSpeed*Math.sin(theta));
  console.log(theta)
  camera.updateMatrix();
  camera.updateProjectionMatrix();
  */
  renderer.render(scene, camera);
  lastTime = time;
  }

function render() {
  renderer.render(scene, camera);
  }

document.addEventListener("keypress", checkKeyboard);
init();
animate();
</script>
<div id=instructions >place cursor left/right to pan; top/bottom to dolly</div>
</body>
</html>
